<!DOCTYPE html>
<html>
<!-- Heroes Persist
    Product which helps in organizing, broadcasting, celebrating events
    Copyright (C) 2014  Sai Pranav
    Email: rsaipranav92@gmail.com

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.
 -->
<head>
<meta charset="ISO-8859-1">
<link rel="shortcut icon" href="webStuff/default/images/icon-32x32.png">

<!-- Login Check Start -->
<script>
function loginCheck(){
	var xmlhttp;
	if(window.XMLHttpRequest){
		xmlhttp = new XMLHttpRequest();
	}else{port
		xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
	}
	xmlhttp.onreadystatechange=function(){
		if(xmlhttp.readyState==4 && xmlhttp.status==200){
			if(xmlhttp.responseText=="true"){
				
			}
			else{
				window.location.assign("login.html");
			}
		}
	}
		xmlhttp.open("GET","logincheck",true);
		xmlhttp.send();
}

loginCheck();
setInterval(function(){loginCheck();},60*1000);
</script>
<!-- Login Check End -->

<meta name="viewport" content="width=device-width, initial-scale=1.0">



<!-- Menu Start-->
<link rel="stylesheet" type="text/css" href="webStuff/Menu/css/normalize.css" />
<link rel="stylesheet" type="text/css" href="webStuff/Menu/css/demo.css" />
<link rel="stylesheet" type="text/css" href="webStuff/Menu/css/icons.css" />
<link rel="stylesheet" type="text/css" href="webStuff/Menu/css/component.css" />
<link href="webStuff/default/css/default.css" rel="stylesheet" media="screen">
<link rel="stylesheet" href="webStuff/vex/css/vex.css" />
<link rel="stylesheet" href="webStuff/vex/css/vex-theme-os.css" />
<script src="webStuff/jquery/jquery-2.0.3.js"></script>
<script src="webStuff/bootstrap/js/bootstrap.min.js"></script>
<script src="webStuff/Menu/js/modernizr.custom.js"></script>
<script src="webStuff/Menu/js/classie.js"></script>
<script src="webStuff/Menu/js/mlpushmenu.js"></script>
<script src="webStuff/vex/js/vex.combined.min.js"></script>
<script>vex.defaultOptions.className = 'vex-theme-os';</script>

<!-- Webservice Ajax Call Start -->
<script type="text/javascript">
	//Global variables
	var currentlyModifying = false;		//true->modifying false->not modifying
	var HOST_AND_PORT = "10.106.50.32:8080";
	var newTeam1 = "";
	var newTeam2 = "";
	
	$.ajax({
		url: 'http://'+ HOST_AND_PORT +'/Sports/api/monitor',
		type: 'post',
		dataType: 'json',
		contentType: 'application/json',
		data: JSON.stringify({"page":"administrator-team-livescores.html"})
	});

	function ajaxCall() {
		$.ajax({
			type: 'get',
			dataType: 'json',
			url:"http://"+HOST_AND_PORT+"/Sports/api/games/teams?gameName=Carrom&gameCategory=Singles&showCriteria=false",
			success:function(data){populateTable(data,"Carrom")},
			error:function(xhr){
				vex.dialog.alert(xhr.responseText);
			}
		});
		
		$.ajax({
			type: 'get',
			dataType: 'json',
			url:"http://"+HOST_AND_PORT+"/Sports/api/games/teams?gameName=BasketBall&gameCategory=NotApplicable&showCriteria=false",
			success:function(data){populateTable(data,"BasketBall")},
			error:function(xhr){
				vex.dialog.alert(xhr.responseText);
			}
		});
		
	}

	ajaxCall();

	function populateTable(response,game) {
		var index = 0;
		if(game == "Carrom"){
			index = 0;
		}
		if(game == "BasketBall"){
			index = 1;
		}
		var teams = response.teams;
		//clear all the records
		document.getElementsByTagName("tbody")[index].innerHTML = "";

		//for every team record
		for ( var i = 0; i < teams.length; i++) {
			
			var newtr = document.createElement("tr");
			
			//put round
			var newtd = document.createElement("td");
			newtd.appendChild(document.createTextNode(teams[i].round));
			newtd.setAttribute("onclick","selected("+teams[i].teamId+");");
			newtr.appendChild(newtd);
			
			//put teamName
			var newtd = document.createElement("td");
			newtd.appendChild(document.createTextNode(teams[i].teamName));
			newtd.setAttribute("onclick","selected("+teams[i].teamId+");");
			newtr.appendChild(newtd);

			//put score
			var newtd = document.createElement("td");
			newtd.appendChild(document.createTextNode(teams[i].score));
			newtd.setAttribute("onclick","selected("+teams[i].teamId+");");
			newtr.appendChild(newtd);
	
			//put save
			var newtd = document.createElement("td");
			var newbutton = document.createElement("button");
			newbutton.setAttribute("onclick","save("+teams[i].teamId+",event);");
			newbutton.setAttribute("class","btn btn-success");
			newtd.appendChild(newbutton);
			newtr.appendChild(newtd);
			
			//put show
			var newtd = document.createElement("td");
			var newbutton = document.createElement("button");
			newbutton.setAttribute("onclick","toggleShow("+teams[i].teamId+",this);");
			if(teams[i].show == false){
				newbutton.setAttribute("class","btn btn-default");
			}
			else{
				newbutton.setAttribute("class","btn btn-warning");
			}
			newtd.appendChild(newbutton);
			newtr.appendChild(newtd);
			
			//put email
			var newtd = document.createElement("td");
			var newimg = document.createElement("img");
			newimg.setAttribute("src", "webStuff/default/images/email_icon.png");
			newimg.setAttribute("onclick","email("+teams[i].teamId+",event);");
			newimg.setAttribute("class","my-email-icon");
			newtd.appendChild(newimg);
			newtr.appendChild(newtd);

			newtr.setAttribute("id",teams[i].teamId);
			
			document.getElementsByTagName("tbody")[index].appendChild(newtr);
			
		}
	}
</script>
<!-- Webservice Ajax Call End -->

<!-- Table Functions Start -->
<script>
function selected(id){
	if(currentlyModifying == false){
		var copyRow = document.getElementById(id).cloneNode(true);
		document.getElementById(id).innerHTML="";

		while(copyRow.hasChildNodes()){
			if(copyRow.firstChild.firstChild.nodeType == 3){
				var newtd = document.createElement("td");
				var newinput = document.createElement("input");
				newinput.setAttribute("type","text");
				newinput.setAttribute("class","form-control");
				newinput.setAttribute("value",copyRow.firstChild.firstChild.nodeValue);
				newtd.appendChild(newinput);
				document.getElementById(id).appendChild(newtd);
			}
			else{
				var newtd = document.createElement("td");
				newbutton = copyRow.firstChild.firstChild;
				if(newbutton.getAttribute("class")=="btn btn-success"){
					newbutton.setAttribute("class","btn btn-danger");
				}
				newtd.appendChild(newbutton);
				document.getElementById(id).appendChild(newtd);
			}
			copyRow.removeChild(copyRow.firstChild);
		}
		currentlyModifying = true;
	}
	else{
		
	}
}

function save(id,e){
	if(currentlyModifying == false){
		
	}
	else{
		var round = "-";
		var score = "-";
		
		var copyRow = document.getElementById(id).cloneNode(true);
		while(copyRow.hasChildNodes()){
			if(copyRow.firstChild.firstChild.getAttribute("class") == "form-control"){
				switch(copyRow.childElementCount){
				case 3 : score = copyRow.firstChild.firstChild.value;break;
				case 4 : newTeam = copyRow.firstChild.firstChild.value;break;
				case 5 : round = copyRow.firstChild.firstChild.value;break;
				}
			}
			copyRow.removeChild(copyRow.firstChild);
		}	
		
		var xmlhttp; 
		if(window.XMLHttpRequest){
			xmlhttp = new XMLHttpRequest();
		}else{
			xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
		}
		xmlhttp.onreadystatechange=function(){
			if(xmlhttp.readyState==4 && xmlhttp.status==200){
				var copyRow = document.getElementById(id).cloneNode(true);
				document.getElementById(id).innerHTML="";

				while(copyRow.hasChildNodes()){
					if(copyRow.firstChild.firstChild.getAttribute("class") == "form-control"){
						var newtd = document.createElement("td");
						newtd.appendChild(document.createTextNode(copyRow.firstChild.firstChild.value));
						newtd.setAttribute("onclick","selected("+id+");");
						document.getElementById(id).appendChild(newtd);
					}
					else{
						var newtd = document.createElement("td");
						newbutton = copyRow.firstChild.firstChild;
						if(newbutton.getAttribute("class")=="btn btn-danger"){
							newbutton.setAttribute("class","btn btn-success");
						}
						newtd.appendChild(newbutton);
						document.getElementById(id).appendChild(newtd);
					}
					copyRow.removeChild(copyRow.firstChild);
				}
				document.getElementById(id).childNodes[document.getElementById(id).childNodes.length-2].firstChild.setAttribute("class","btn btn-success");
				currentlyModifying = false;
			}
			else if(xmlhttp.readyState == 4 && xmlhttp.status == 400){
				vex.dialog.alert(xmlhttp.responseText);
			}
			else if(xmlhttp.readyState == 4 && xmlhttp.status == 404){
				vex.dialog.alert("Give all the details required to process (OR) -");
			}
		}
		xmlhttp.open("PUT","http://"+HOST_AND_PORT+"/Sports/api/teams/"+id,true);
		xmlhttp.setRequestHeader("Content-type","application/json");
		var data = {name:newTeam,score:score,round:round};
		xmlhttp.send(JSON.stringify(data));
	}
}

function toggleShow(id,button){
	if(currentlyModifying == false){
		var xmlhttp;
		if(window.XMLHttpRequest){
			xmlhttp = new XMLHttpRequest();
		}else{
			xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
		}
		xmlhttp.onreadystatechange=function(){
			if(xmlhttp.readyState==4 && xmlhttp.status==200){
				if(button.getAttribute("class") == "btn btn-default"){
					button.setAttribute("class","btn btn-warning");
				}
				else{
					button.setAttribute("class","btn btn-default");
				}
			}
		}
		if(button.getAttribute("class") == "btn btn-default"){
			xmlhttp.open("PUT","http://"+HOST_AND_PORT+"/Sports/api/teams/"+id+"/show/"+true,true);
		}
		else{
			xmlhttp.open("PUT","http://"+HOST_AND_PORT+"/Sports/api/teams/"+id+"/show/"+false,true);
		}
		xmlhttp.send();
	}
	else{
		vex.dialog.alert("Save Then Show");
	}
}

function email(teamId){
	$.ajax({
		url: 'http://'+ HOST_AND_PORT +'/Sports/api/teams/'+teamId+'/playeremails',
		type: 'get',
		dataType: 'json',
		contentType: 'application/json',
		success: function(data){
			var toField = "";
			for(var i=0; i<data.length; i++){
				toField = data[i]+",";
			}
			 window.location = "mailto:"+toField;
		},
		error: function(xhr){
			if(xhr.status == 404){
				vex.dialog.alert("Services not Running");
			}
			else{
				vex.dialog.alert(xhr.responseText);
			}
		}
	});
}

</script>
<!-- Table Functions End -->

<title>::: Heroes Persist Admin Live Scores:::</title>
</head>
<body>
	<!-- Push Wrapper -->
	<div class="mp-pusher" id="mp-pusher">
		<!-- mp-menu -->
		<nav id="mp-menu" class="mp-menu">
			<div class="mp-level">
				<h2><img src="webStuff/default/images/icon.png" height="80px" width="80px"></img>Menu</h2>
				<ul>
					<li><a class="icon icon-wallet" href="administrator-livescores.html">Match Live Scores</a></li>
					<li><a class="icon icon-wallet" href="#">Team Live Scores</a></li>
					<li><a class="icon icon-wallet"	href="administrator-dashboard.html">Dashboard</a></li>
					<li><a class="icon icon-wallet" href="logout">Log Out</a></li>
				</ul>
			</div>
		</nav>
		<!-- /mp-menu -->

		<div class="scroller">
			<!-- this is for emulating position fixed of the nav -->
			<div class="scroller-inner">
				<a href="#" id="trigger" class="menu-trigger">Menu<img src="webStuff/default/images/logo.png" id="logo"></img></a>
				<div class="page-header">Live Scores</div>
				<!-- Live Scores Starts-->
				<div class="livescores">
					<div class="game">
						<div class="topic">
							<p>CARROM</p>
						</div>
						<div class="span4">
							<table class="table table-striped">
								<thead>
									<tr>
										<th>Round</th>
										<th>Team</th>
										<th>Score</th>
										<th>Save</th>
										<th>Show</th>
										<th>Email</th>
									</tr>
								</thead>
								<tbody>
								</tbody>
							</table>
						</div>
					</div>
					<div class="game">
						<div class="topic">
							<p>BASKETBALL</p>
						</div>
						<div class="span4">
							<table class="table table-striped">
								<thead>
									<tr>
										<th>Round</th>
										<th>Team</th>
										<th>Score</th>
										<th>Save</th>
										<th>Show</th>
										<th>Email</th>
									</tr>
								</thead>
								<tbody>
								</tbody>
							</table>
						</div>
					</div>
				</div>
					<!-- Live Scores End-->
				</div>
				<!-- /scroller-inner -->
			</div>
			<!-- /scroller -->

		</div>
		<!-- /pusher -->
	<!-- /container -->
	<script>
		new mlPushMenu(document.getElementById('mp-menu'), document.getElementById('trigger'));
	</script>
</body>
</html>